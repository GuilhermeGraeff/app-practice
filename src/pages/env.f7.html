<template>
  <div data-name="env">
    {{#if environment}}
      <!-- Title -->
      <div class="block-title text-align-center">
        <h3 class="no-margin">{{environment.name}}</h3>
        <small>
          {{environment.university}}
          {{#if environment.campus}}, {{environment.campus}}{{/if}}
        </small>
      </div>
      <!-- Pins -->
      {{#each environment.pins}}
        <div class="card">
          {{#if this.title}}
            <div class="card-header">{{this.title}}</div>
          {{/if}}
          <!-- Text -->
          {{#js_if "this.type == 'text'"}}
            <div class="card-content card-content-padding">
              {{this.content}}
            </div>
          {{/js_if}}
          <!-- Embed -->
          {{#js_if "this.type == 'embed'"}}
            <div class="card-content card-content-padding">
              <iframe src="{{this.content}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width: 100%; height: auto;"></iframe>
            </div>
          {{/js_if}}
          <!-- Action -->
          {{#js_if "this.type == 'action'"}}
            <form id="action-{{this.id}}" onSubmit="return false;" @submit="executeAction('action-{{this.id}}', '{{this.method}}')">
              <div class="card-content card-content-padding">
                {{#if this.inputs}}
                  <div class="list no-hairlines">
                    <ul>
                      {{#each this.inputs}}
                        {{#js_if "this.type === 'text' || this.type === 'email' || this.type === 'number' || this.type === 'tel' || this.type === 'url' || this.type === 'date' || this.type === 'datetime-local'"}}
                          <li class="item-content item-input item-input-outline">
                            <div class="item-inner">
                              <div class="item-title item-floating-label">{{this.label}}</div>
                              <div class="item-input-wrap">
                                <input type="{{this.type}}" name="{{this.name}}" required validate />
                                <span class="input-clear-button"></span>
                              </div>
                            </div>
                          </li>
                        {{/js_if}}
                        {{#js_if "this.type === 'select'"}}
                          <li class="item-content item-input item-input-outline">
                            <div class="item-inner">
                              <div class="item-title item-floating-label">{{this.label}}</div>
                              <div class="item-input-wrap input-dropdown-wrap">
                                <select name="{{this.name}}" required validate>
                                  <option value=""></option>
                                  {{#each this.options}}
                                    <option value="{{this.value}}">{{this.label}}</option>
                                  {{/each}}
                                </select>
                              </div>
                            </div>
                          </li>
                        {{/js_if}}
                      {{/each}}
                    </ul>
                  </div>
                {{/if}}
              </div>
              <div class="card-footer">
                <input type="submit" class="button button-raised button-fill margin-vertical" value="Confirmar">
              </div>
            </form>
          {{/js_if}}
          <!-- Survey -->
          {{#js_if "this.type === 'survey'"}}
            <form id="action-{{this.id}}" onSubmit="return false;" @submit="executeAction('action-{{this.id}}', '{{this.method}}')">
              <div class="card-content card-content-padding">
                <div class="item-inner">
                  <div class="item-title">{{this.label}}</div>
                      {{#each this.options}}
                        <button class="button button-round button-outline" style="margin: 7px 0; text-transform: none;"
                          type="submit" value="{{this.value}}" name="{{../name}}">{{this.label}}</button>                          
                      {{/each}}
                </div>
              </div>
            </form>
          {{/js_if}}
        </div>
      {{/each}}
      <!-- Bus Schedueles-->
      {{#if environment.bus_itineraries}}
        <div class="card card-expandable" style="height: 100px">
          <div class="card-content">
            <div style="height: 30vw; background-image:url(https://www.tudodechapeco.com.br/arquivos_personalizados/uploads/biblioteca_imagens/02_60266e404cf32.jpg)"
              class="card-header"></div>
            <a href="#" class="link card-close card-opened-fade-in color-black" style="position: absolute; right: 15px; top: 15px">
              <i class="icon f7-icons">xmark_circle_fill</i>
            </a>
            <div class="list media-list no-ios-edges">
              <ul>
                {{#each environment.bus_itineraries}}
                <li class="item-content">
                  <div class="item-inner">
                    <div class="item-title-row">
                        <div class="item-title"><p style="font-size: 1.5em">{{this.time}}</p></div>
                        <div style="width: 70%; text-align: center; font-size: 1.4em;"><p>{{this.destiny}}</p></div>
                    </div>  
                  </div>
                </li>
                {{/each}}
                <li class="item-content">
                  ...
                </li>
                <div class="card-footer"> <span> </span><span>Não se atrase!!</span></div>
              </ul>
            </div>
          </div>
        </div>
      {{/if}}
    {{else}}
      <div class="skeleton-text skeleton-effect-blink">
        <!-- Title -->
        <div class="block-title text-align-center">
          <h3 class="no-margin">___________________</h3>
          <small>___________</small>
        </div>
        <!-- Pins -->
        {{#each '01234'}}
          <div class="card">
            <div class="card-header">_______________</div>
            <div class="card-content card-content-padding">
              _____________________
            </div>
          </div>
        {{/each}}
      </div>
    {{/if}}

    <!-- Opção 3 -->
    <div class="card card-expandable" style="height: 100px">
      <div class="card-content">
          <div class="card-header"
            style="background-image: url(../static/images/meal.svg);
            min-height: 100px;
            background-repeat: no-repeat;
            background-size: 100%;
            background-color: rgba(45,120,156,0.6);
            color: white;
            font-weight: bold;
            ">
            Cardápio do RU
          </div>
          <a href="#" class="link card-close card-opened-fade-in color-black" style="position: absolute; right: 15px; top: 15px">
            <i class="icon f7-icons">xmark_circle_fill</i>
          </a>
        <div class="card-content-padding" style="vertical-align: center;">
          <b>O cardápio de segunda-feira será:</b>
          <ul>
            <li>Acelga</li>
            <li>Pepino</li>
            <li>Beterraba cozida</li>
            <li>Arroz branco</li>
            <li>Arroz integral</li>
            <li>Feijão preto</li>
            <li>Batata palha</li>
            <li>Estrogonofe bovino (contém lactose)</li>
            <li>Estrogonofe de grão-de-bico (contém lactose)</li>
            <li>Fruta</li>
          </ul>
        </div>
        <div class="card-footer"
        style="align-content: center;">
          <input type="submit" class="button button-raised button-fill margin-vertical" value="Saiba Mais">
      </div>
      </div>
    </div>

  </div>
</template>
<script>
  let today = Date.now();
  let date_obj = new Date(today);
  let month = date_obj.getMonth() + 1;
  export default {
    data: function () {
      return {
        environment: null,
      }
    },
    methods: {
      loadData: function () {
        var self = this;
        var app = self.$app;

        app.request.json('../static/example-data/environment.json', function (data) {
          // Sleeping only to show loading effects
          setTimeout(function () {
            // Setting data
            self.$setState({
              environment: data,
            });
          }, 1000);
        });
      },
      executeAction: function (form_id, method) {
        let self = this
        let app = self.$app

        app.dialog.preloader('Aguarde')
        let data = app.form.convertToData('#'+form_id)

        // Sleeping only to show loading effects
        setTimeout(function () {
          // Requisiting
          app.request.promise.get(method, data)
          .then(function (res) {
            app.dialog.close()
            if (res) {
              app.dialog.alert('Ação executada com sucesso!', '')
            } 
            else
              app.dialog.alert('Um erro inesperado ocorreu!', '')
          })
        }, 500)
      }
    },
    on: {
      tabInit: function (e, page) {
        this.loadData()
      },
    },
  }
</script>